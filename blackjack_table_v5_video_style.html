# Recreate the v5 blackjack HTML file and provide a downloadable link for the user.
html_path = "/mnt/data/blackjack_table_v5_video_style.html"
html_content = """<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Blackjack — v5 (Style vidéo, cartes & jetons)</title>
<style>
:root{ --felt:#0f7f8f; --felt-d:#0a5e6f; --gold:#ffd973; --chip-edge:#f1f1f1; --shadow:rgba(0,0,0,.45); }
*{box-sizing:border-box} html,body{height:100%}
body{ margin:0; background:#0b1b23; color:#fff; font:14px/1.35 Inter,system-ui,Segoe UI,Roboto,Helvetica,Arial,sans-serif; overflow:hidden; user-select:none }
.topbar{ position:fixed; inset:0 0 auto 0; height:56px; display:flex; gap:28px; align-items:center; padding:0 18px; background:linear-gradient(#0b1a22,#0a1820); border-bottom:1px solid #0d2a34; z-index:1000 }
.metric{font-weight:800; letter-spacing:.35px; text-transform:uppercase; display:flex; gap:8px; align-items:baseline}
.metric b{color:var(--gold); cursor:pointer; padding:4px 6px; border-radius:8px}
.metric b:hover{background:#132d39} .spacer{flex:1}
.wrap{position:fixed; inset:56px 0 0 0; display:grid; place-items:center; padding:10px}
.table{ position:relative; width:min(1400px,96vw); height:min(820px,calc(96vh - 56px)); border-radius:22px; overflow:hidden;
  box-shadow:0 40px 120px rgba(0,0,0,.6), inset 0 1px 0 rgba(255,255,255,.06);
  background: radial-gradient(800px 400px at 50% 45%, rgba(255,255,255,.05), transparent 70%),
             radial-gradient(1600px 1200px at 50% 60%, var(--felt) 0%, var(--felt-d) 100%); }
.table::before{ content:""; position:absolute; inset:0;
  background: linear-gradient(115deg, rgba(255,255,255,.06), transparent 30%),
             radial-gradient(1200px 800px at 50% 70%, rgba(0,0,0,.25), transparent 60%),
             repeating-linear-gradient(20deg, rgba(255,255,255,.02) 0 2px, rgba(0,0,0,.03) 2px 4px);
  mix-blend-mode:overlay; pointer-events:none }
.rim{ position:absolute; inset:12px; border-radius:18px; box-shadow:inset 0 0 0 8px rgba(0,0,0,.12), inset 0 0 0 2px rgba(255,255,255,.06) }
.svg-arches{ position:absolute; inset:auto 0 58% 0; pointer-events:none; opacity:.92 }
.svg-arches svg{ width:100%; height:240px } .svg-arches text{ font:900 24px/1.1 "Trajan Pro", Georgia, serif; letter-spacing:2px; fill:rgba(255,255,255,.85) }
.bet-limits{ position:absolute; right:22px; top:18px; text-align:right; opacity:.9; font-weight:700; color:#e6f8fd }
.seats{ position:absolute; left:0; right:0; bottom:170px; display:flex; justify-content:space-evenly; align-items:center }
.seat{ position:relative; width:280px; height:220px; display:grid; place-items:center }
.seat .circle{ width:160px; height:160px; border-radius:999px;
  background:radial-gradient(circle at 35% 35%, rgba(255,255,255,.18), rgba(255,255,255,.04) 62%, rgba(0,0,0,.18) 64%, rgba(255,255,255,.06) 66%);
  box-shadow:inset 0 0 40px rgba(0,0,0,.3); display:grid; place-items:center; position:relative; cursor:pointer }
.seat .label{ position:absolute; top:-26px; font-weight:800; opacity:.9 }
.seat .stack{ position:absolute; inset:auto 0 18px 0; display:flex; justify-content:center; gap:4px; pointer-events:none }
.stack .chip-mini{ width:26px; height:26px; border-radius:50%; box-shadow:0 6px 12px rgba(0,0,0,.45), inset 0 0 0 4px rgba(255,255,255,.12); position:relative }
.stack .chip-mini::before{ content:""; position:absolute; inset:6px; border-radius:50%; background:conic-gradient(from 18deg, #eee 0 18deg, transparent 18deg 36deg); opacity:.8;
  mask: radial-gradient(circle at 50% 50%, transparent 40%, #000 41%) }
.seat .amt{ position:absolute; bottom:10px; font-weight:900; background:rgba(0,0,0,.35); padding:6px 10px; border-radius:10px }
.hand-area{ position:absolute; top:-40px; left:50%; transform:translateX(-50%); width:100%; min-height:120px; display:flex; justify-content:center; gap:12px }
.total-tag{ position:absolute; top:-30px; left:50%; transform:translateX(-50%); background:rgba(0,0,0,.45); padding:4px 8px; border-radius:8px; font-weight:900 }
.dealer{ position:absolute; top:90px; left:50%; transform:translateX(-50%); text-align:center }
.dealer .row{ display:flex; justify-content:center; gap:12px; margin-top:10px } .dealer .label{ font-weight:900; letter-spacing:.6px; opacity:.95 }
.dealer .total{ margin-top:6px; display:inline-block; background:rgba(0,0,0,.45); padding:4px 8px; border-radius:8px; font-weight:900 }
.card-wrap{ perspective: 800px }
.card{ width:74px; height:104px; border-radius:10px; background:#fff; color:#111; border:2px solid #e4e4e4; box-shadow:0 10px 18px var(--shadow); position:relative; transform-style:preserve-3d; backface-visibility:hidden; }
.card.red{ color:#c02626 }
.corner{ position:absolute; left:6px; top:4px; text-align:center; font-weight:900; line-height:1 }
.corner .rank{ font-size:16px } .corner .suit{ font-size:14px } .corner.br{ left:auto; right:6px; top:auto; bottom:4px; transform:rotate(180deg) }
.pip{ position:absolute; font-size:18px } .face{ position:absolute; inset:0; display:grid; place-items:center; font-size:42px; opacity:.9 }
.card.back, .card .backface{ background:repeating-linear-gradient(45deg,#1b4c61,#1b4c61 6px,#0f2d39 6px,#0f2d39 12px); border-color:#0f2d39 }
.backface{ position:absolute; inset:0; border-radius:10px; transform:rotateY(180deg); backface-visibility:hidden }
.flip{ transition: transform .45s cubic-bezier(.2,.7,.2,1) }
.flipped{ transform: rotateY(180deg) }
#shoeOrigin{ position:absolute; right:60px; bottom:90px; width:72px; height:30px; border-radius:8px; background:linear-gradient(#8b6b3f,#6e512e); box-shadow:0 12px 22px rgba(0,0,0,.45), inset 0 0 0 2px rgba(255,255,255,.15) }
.chips{ position:absolute; left:0; right:0; bottom:88px; display:flex; justify-content:center; gap:12px; flex-wrap:wrap }
.chip{ width:64px; height:64px; border-radius:999px; display:grid; place-items:center; font-weight:900; color:#fff; cursor:pointer;
  box-shadow:0 14px 28px rgba(0,0,0,.5), inset 0 0 0 6px rgba(255,255,255,.15), inset 0 20px 28px rgba(0,0,0,.25); position:relative }
.chip::before{ content:""; position:absolute; inset:10px; border-radius:999px; background:
  conic-gradient(from 20deg, var(--chip-edge) 0 20deg, transparent 20deg 40deg); box-shadow:inset 0 6px 16px rgba(0,0,0,.3);
  mask: radial-gradient(circle at 50% 50%, transparent 38%, #000 39%); opacity:.75 }
.chip small{ font-size:12px } .chip.active{ outline:4px solid rgba(255,255,255,.45); transform:translateY(-2px) }
.chip[data-v="0.5"]{ background:#d64b4b } .chip[data-v="1"]{ background:#444 } .chip[data-v="5"]{ background:#c33 } .chip[data-v="25"]{ background:#2e9a2e }
.chip[data-v="100"]{ background:#222 } .chip[data-v="500"]{ background:#6b37c8 } .chip[data-v="1000"]{ background:#c47c1d } .chip[data-v="5000"]{ background:#c4561d }
.controls{ position:absolute; left:0; right:0; bottom:18px; display:flex; justify-content:center; gap:10px; flex-wrap:wrap }
button{ border:0; background:#113445; color:#dff8ff; padding:10px 14px; font-weight:800; border-radius:12px; cursor:pointer; letter-spacing:.6px;
  box-shadow:0 6px 16px rgba(0,0,0,.35), inset 0 0 0 2px rgba(255,255,255,.05) }
button:hover{ filter:brightness(1.08) } .hidden{ display:none !important }
.stats{ position:absolute; left:16px; bottom:18px; font-size:12px; color:#d8eef5; opacity:.85; font-weight:600; background:rgba(0,0,0,.25); padding:8px 10px; border-radius:10px }
.toast{ position:absolute; left:50%; transform:translateX(-50%); bottom:150px; background:rgba(0,0,0,.55); padding:10px 16px; border-radius:12px; font-weight:800; display:none }
#dealerBank{ position:absolute; right:40px; bottom:84px; width:80px; height:40px; border-radius:10px; background:linear-gradient(#6b4928,#583b1f); box-shadow:0 10px 20px rgba(0,0,0,.5) }
.motion{ position:fixed; width:22px; height:22px; border-radius:50%; box-shadow:0 8px 18px rgba(0,0,0,.5), inset 0 0 0 4px rgba(255,255,255,.15);
  background: radial-gradient(circle at 35% 35%, rgba(255,255,255,.5), rgba(255,255,255,.15) 40%, rgba(0,0,0,.5));
  offset-rotate: 0deg; animation: fly 650ms cubic-bezier(.23,.85,.25,1) forwards; }
@keyframes fly { to { offset-distance: 100%; opacity:.2; } }
</style>
</head>
<body>
<div class="topbar">
  <div class="metric">BALANCE <b id="balance">$5,000.00</b></div>
  <div class="metric">TOTAL BET <b id="totalBet">$0.00</b></div>
  <div class="metric">WIN <b id="winAmt">$0.00</b></div>
  <div class="spacer"></div><div style="opacity:.8">Practice only</div>
</div>

<div class="wrap">
  <div class="table" id="table">
    <div class="rim"></div>

    <div class="svg-arches">
      <svg viewBox="0 0 1200 240" preserveAspectRatio="none">
        <defs>
          <path id="arc1" d="M100,200 A500,500 0 0,1 1100,200" />
          <path id="arc2" d="M180,170 A420,420 0 0,1 1020,170" />
          <path id="arc3" d="M260,142 A340,340 0 0,1 940,142" />
        </defs>
        <text dy="-8"><textPath href="#arc1" startOffset="50%" text-anchor="middle">CLASSIC BLACKJACK</textPath></text>
        <text><textPath href="#arc2" startOffset="50%" text-anchor="middle">BLACKJACK PAYS 3 TO 2</textPath></text>
        <text dy="10"><textPath href="#arc3" startOffset="50%" text-anchor="middle">INSURANCE PAYS 2 TO 1 • DEALER MUST HIT SOFT 17</textPath></text>
      </svg>
    </div>

    <div class="bet-limits"><b>Sans limite</b><div style="opacity:.8">Min $0.01 • Max ∞</div></div>
    <div id="shoeOrigin" title="Shoe"></div>
    <div id="dealerBank" title="Banque du croupier"></div>

    <div class="dealer">
      <div class="label">CROUPIER</div>
      <div class="row" id="dealerRow"></div>
      <div class="total" id="dealerTotal">—</div>
    </div>

    <div class="seats">
      <div class="seat" data-idx="0"><div class="label">SEAT 1</div><div class="hand-area"><div class="total-tag">—</div></div><div class="circle"><div class="stack"></div><div class="amt">BET</div></div></div>
      <div class="seat" data-idx="1"><div class="label">SEAT 2</div><div class="hand-area"><div class="total-tag">—</div></div><div class="circle"><div class="stack"></div><div class="amt">BET</div></div></div>
      <div class="seat" data-idx="2"><div class="label">SEAT 3</div><div class="hand-area"><div class="total-tag">—</div></div><div class="circle"><div class="stack"></div><div class="amt">BET</div></div></div>
    </div>

    <div class="chips" id="chips">
      <div class="chip" data-v="0.5"><small>$.50</small></div><div class="chip" data-v="1"><small>$1</small></div><div class="chip" data-v="5"><small>$5</small></div>
      <div class="chip" data-v="25"><small>$25</small></div><div class="chip" data-v="100"><small>$100</small></div><div class="chip" data-v="500"><small>$500</small></div>
      <div class="chip" data-v="1000"><small>$1k</small></div><div class="chip" data-v="5000"><small>$5k</small></div>
      <button id="customChipBtn">+ Chip</button>
    </div>

    <div class="controls" id="controls">
      <button id="clearBets" data-group="bet">Clear</button>
      <button id="rebet" data-group="bet">Rebet</button>
      <button id="deal" data-group="bet">Deal</button>
      <button id="shuffle" data-group="bet">Shuffle</button>

      <button id="hit" data-group="act" class="hidden">Hit</button>
      <button id="stand" data-group="act" class="hidden">Stand</button>
      <button id="double" data-group="act" class="hidden">Double</button>
      <button id="split" data-group="act" class="hidden">Split</button>
      <button id="surrender" data-group="act" class="hidden">Surrender</button>
    </div>

    <div class="stats" id="stats">Hands: 0 • Won: 0 • Lost: 0 • Push: 0</div>
    <div class="toast" id="toast">—</div>
  </div>
</div>

<script>
const $=(s,r=document)=>r.querySelector(s); const $$=(s,r=document)=>Array.from(r.querySelectorAll(s));
const money=n=>'$'+Number(n).toLocaleString(undefined,{minimumFractionDigits:2,maximumFractionDigits:2}); const rand=(a,b)=>Math.floor(Math.random()*(b-a+1))+a;
const SUITS=['♠','♥','♦','♣'], RANKS=['A','2','3','4','5','6','7','8','9','10','J','Q','K']; const COLOR=s=>(s==='♥'||s==='♦')?'red':'black';
let shoe=[], pen=0;
function buildShoe(decks=6){ const cards=[]; for(let d=0;d<decks;d++){ for(const s of SUITS){ for(const r of RANKS){ cards.push({rank:r,suit:s}); } } }
  for(let i=cards.length-1;i>0;i--){ const j=Math.floor(Math.random()*(i+1)); [cards[i],cards[j]]=[cards[j],cards[i]]; }
  shoe=cards; pen=Math.floor(cards.length*0.75); toast('Nouveau shoe 6 decks.'); }
function drawCard(){ if(shoe.length<=pen) buildShoe(); return shoe.pop(); }
function handValue(cards){ let total=0, aces=0; for(const c of cards){ if(c.rank==='A'){aces++; total+=11;} else if(['10','J','Q','K'].includes(c.rank)){ total+=10; } else total+=parseInt(c.rank,10); }
  while(total>21 && aces>0){ total-=10; aces--; } const soft=(aces>0 && total<=21); const isBJ=(cards.length===2 && total===21); return {total,soft,isBJ}; }
function createCardEl(card, hidden=false){ const wrap=document.createElement('div'); wrap.className='card-wrap'; const el=document.createElement('div'); el.className='card flip'+(hidden?' flipped':'');
  if(COLOR(card.suit)==='red') el.classList.add('red');
  const front=document.createElement('div'); front.className='front'; front.style.position='absolute'; front.style.inset='0'; front.style.borderRadius='10px'; front.style.backfaceVisibility='hidden';
  const tl=document.createElement('div'); tl.className='corner'; tl.innerHTML=`<div class="rank">${card.rank}</div><div class="suit">${card.suit}</div>`;
  const br=tl.cloneNode(true); br.classList.add('br'); front.appendChild(tl); front.appendChild(br);
  placePips(front,card.rank,card.suit);
  const back=document.createElement('div'); back.className='backface'; el.appendChild(front); el.appendChild(back); wrap.appendChild(el); return wrap; }
const PIP_POS={ top:[{x:50,y:16}], mid:[{x:50,y:50}], bot:[{x:50,y:84}], quads:[{x:30,y:28},{x:70,y:28},{x:30,y:72},{x:70,y:72}], six:[{x:30,y:22},{x:70,y:22},{x:30,y:50},{x:70,y:50},{x:30,y:78},{x:70,y:78}],
  seven:[{x:50,y:14},{x:30,y:26},{x:70,y:26},{x:30,y:50},{x:70,y:50},{x:30,y:74},{x:70,y:74}], eight:[{x:30,y:22},{x:70,y:22},{x:30,y:38},{x:70,y:38},{x:30,y:62},{x:70,y:62},{x:30,y:78},{x:70,y:78}],
  nine:[{x:50,y:14},{x:30,y:26},{x:70,y:26},{x:30,y:42},{x:70,y:42},{x:50,y:50},{x:30,y:66},{x:70,y:66},{x:50,y:84}],
  ten:[{x:30,y:18},{x:70,y:18},{x:30,y:34},{x:70,y:34},{x:30,y:50},{x:70,y:50},{x:30,y:66},{x:70,y:66},{x:30,y:82},{x:70,y:82}] };
function placePips(container,rank,suit){ const add=pts=>pts.forEach(p=>{ const pip=document.createElement('div'); pip.className='pip'; pip.textContent=suit; pip.style.left=p.x+'%'; pip.style.top=p.y+'%'; pip.style.position='absolute'; pip.style.transform='translate(-50%,-50%)'; container.appendChild(pip); });
  switch(rank){ case 'A': add(PIP_POS.mid); break; case '2': add([PIP_POS.top[0],PIP_POS.bot[0]]); break; case '3': add([PIP_POS.top[0],PIP_POS.mid[0],PIP_POS.bot[0]]); break;
  case '4': add(PIP_POS.quads); break; case '5': add([...PIP_POS.quads,PIP_POS.mid[0]]); break; case '6': add(PIP_POS.six); break; case '7': add(PIP_POS.seven); break;
  case '8': add(PIP_POS.eight); break; case '9': add(PIP_POS.nine); break; case '10': add(PIP_POS.ten); break;
  case 'J': case 'Q': case 'K': const face=document.createElement('div'); face.className='face'; face.textContent=suit; container.appendChild(face); break; } }
function toast(msg,ms=1400){ const t=$("#toast"); t.textContent=msg; t.style.display='block'; clearTimeout(t._to); t._to=setTimeout(()=>t.style.display='none',ms); }

const state={ balance:5000,lastBets:[0,0,0],bets:[0,0,0],hands:[[],[],[]],dealer:[],activeSeat:0,activeHand:0,inRound:false,stats:{hands:0,won:0,lost:0,push:0},win:0 };
class Hand{ constructor(bet){ this.bet=bet; this.cards=[]; this.done=false; this.surrender=false; this.doubled=false; this.insurance=0; this.isSplitAce=false; }}

function renderTop(){ $("#balance").textContent=money(state.balance); $("#totalBet").textContent=money(totalBet()); $("#winAmt").textContent=money(state.win); }
function renderStats(){ const s=state; $("#stats").textContent=`Hands: ${s.stats.hands} • Won: ${s.stats.won} • Lost: ${s.stats.lost} • Push: ${s.stats.push}`; }
function totalBet(){ return state.bets.reduce((a,b)=>a+b,0); }

const CHIP_COLORS={0.5:'#d64b4b',1:'#444',5:'#c33',25:'#2e9a2e',100:'#222',500:'#6b37c8',1000:'#c47c1d',5000:'#c4561d'};
const DENOMS=[5000,1000,500,100,25,5,1,0.5];
function makeMiniChip(color){ const d=document.createElement('div'); d.className='chip-mini'; d.style.background=color; return d; }
function amountToChipStack(amount){ const stack=[]; let rem=+amount.toFixed(2);
  for(const d of DENOMS){ let n = (d===0.5) ? Math.round((rem + 1e-6)/d) : Math.floor(rem/d); for(let i=0;i<n;i++) stack.push(d); rem = +(rem - d*n).toFixed(2); }
  return stack.slice(0,12);
}
function renderSeatStack(idx){ const seat=document.querySelector(`.seat[data-idx="${idx}"]`); const stackEl=seat.querySelector('.stack'); const amtEl=seat.querySelector('.amt'); const v=state.bets[idx];
  stackEl.innerHTML=''; if(v<=0){ amtEl.textContent='BET'; return; } const chips=amountToChipStack(v); chips.forEach(val=>{ const chip=makeMiniChip(CHIP_COLORS[val]); stackEl.appendChild(chip); }); amtEl.textContent=money(v); }
function refreshBetsUI(){ for(let i=0;i<3;i++) renderSeatStack(i); renderTop(); }
function clearBets(){ state.bets=[0,0,0]; refreshBetsUI(); }
function rebet(){ state.bets=[...state.lastBets]; refreshBetsUI(); }

function createAndAnimateCard(toEl, card, faceUp=true){ const temp=createCardEl(card,true); document.body.appendChild(temp);
  const start=document.querySelector("#shoeOrigin").getBoundingClientRect(); const end=toEl.getBoundingClientRect();
  const cx=start.left+start.width/2, cy=start.top+start.height/2, tx=end.left+end.width/2, ty=end.top+end.height/2;
  temp.style.position='fixed'; temp.style.left=(cx-37)+'px'; temp.style.top=(cy-52)+'px'; temp.style.transition='transform .35s cubic-bezier(.2,.7,.25,1)';
  requestAnimationFrame(()=>{ temp.style.transform=`translate(${tx-cx}px, ${ty-cy}px) rotate(${Math.floor(Math.random()*9-4)}deg)`; });
  return new Promise(res=>{ temp.addEventListener('transitionend', ()=>{ const real=createCardEl(card,!faceUp); toEl.appendChild(real); if(faceUp){ setTimeout(()=>{ real.querySelector('.card').classList.remove('flipped'); }, 20); } temp.remove(); res(); }, {once:true}); });
}
function flipHoleCard(){ const row=document.querySelector("#dealerRow"); const last=row.children[1]; if(!last) return; last.querySelector('.card').classList.remove('flipped'); }

function pathArc(x1,y1,x2,y2,curve=0.3){ const dx=x2-x1; const cx1=x1+dx*curve, cy1=y1-80; const cx2=x2-dx*curve, cy2=y2-80; return `M ${x1} ${y1} C ${cx1} ${cy1}, ${cx2} ${cy2}, ${x2} ${y2}`; }
function animateChipsPath(fromRect, toRect, count=8){
  for(let i=0;i<count;i++){ const el=document.createElement('div'); el.className='motion'; document.body.appendChild(el);
    const sx=fromRect.left+fromRect.width/2+(Math.random()*20-10), sy=fromRect.top+fromRect.height/2+(Math.random()*16-8);
    const tx=toRect.left+toRect.width/2+(Math.random()*20-10), ty=toRect.top+toRect.height/2+(Math.random()*16-8);
    el.style.offsetPath = `path('${pathArc(sx,sy,tx,ty)}')`; setTimeout(()=>el.remove(), 720); }
}

function renderAllHands(){
  const drow=document.querySelector("#dealerRow"); drow.innerHTML='';
  state.dealer.forEach((c,i)=>{ const hide=state.inRound && i===1 && !allPlayersDone(); const host=document.createElement('div'); drow.appendChild(host); const el=createCardEl(c, hide); host.appendChild(el); if(!hide) setTimeout(()=> el.querySelector('.card').classList.remove('flipped'), 0); });
  const dv=handValue(state.dealer); document.querySelector("#dealerTotal").textContent=(state.inRound && !allPlayersDone()? '—' : (dv.total<=21? (dv.total+(dv.soft?' (soft)':'')) : 'BUST'));
  document.querySelectorAll(".seat").forEach((seat,i)=>{ const area=seat.querySelector('.hand-area'); area.innerHTML='<div class="total-tag">—</div>'; const hands=state.hands[i]||[]; hands.forEach((h,hi)=>{
    const wrap=document.createElement('div'); wrap.style.display='inline-flex'; wrap.style.marginRight='12px';
    h.cards.forEach(c=>{ const host=document.createElement('div'); wrap.appendChild(host); const el=createCardEl(c,false); host.appendChild(el); setTimeout(()=>el.querySelector('.card').classList.remove('flipped'),0); });
    area.appendChild(wrap); const v=handValue(h.cards); const totalEl=area.querySelector('.total-tag'); totalEl.textContent=v.total<=21? v.total+(v.soft?' (soft)':'') : 'BUST';
    if(i===state.activeSeat && hi===state.activeHand && state.inRound && !h.done){ totalEl.style.outline='3px solid rgba(255,255,255,.45)'; } else totalEl.style.outline='none'; }); });
}

function showBettingControls(show){ document.querySelectorAll('[data-group="bet"]').forEach(b=>b.classList.toggle('hidden', !show)); }
function setActionVisibility({hit,stand,double,split,surrender}){
  document.querySelector('#hit').classList.toggle('hidden', !hit);
  document.querySelector('#stand').classList.toggle('hidden', !stand);
  document.querySelector('#double').classList.toggle('hidden', !double);
  document.querySelector('#split').classList.toggle('hidden', !split);
  document.querySelector('#surrender').classList.toggle('hidden', !surrender);
}
function refreshControls(){ if(!state.inRound){ showBettingControls(true); setActionVisibility({hit:false,stand:false,double:false,split:false,surrender:false}); } else { showBettingControls(false); updateActionsForActive(); } }

let selectedChip=5; function selectChip(v){ selectedChip=+v; document.querySelectorAll('.chip').forEach(c=>c.classList.toggle('active', +c.dataset.v===selectedChip)); }
selectChip(5);
document.querySelector('#customChipBtn').addEventListener('click',()=>{ const val=parseFloat(prompt('Montant du jeton personnalisé:','50')); if(!isFinite(val)||val<=0) return;
  const chip=document.createElement('div'); chip.className='chip'; chip.dataset.v=String(val); chip.innerHTML=`<small>$${val}</small>`; document.querySelector('#chips').insertBefore(chip,document.querySelector('#customChipBtn'));
  chip.addEventListener('click',()=>selectChip(val)); selectChip(val); });
document.querySelectorAll('.chip').forEach(c=>c.addEventListener('click',()=>selectChip(c.dataset.v)));
document.querySelectorAll('.seat').forEach(seat=>{ const idx=+seat.dataset.idx;
  seat.querySelector('.circle').addEventListener('click',()=>{ if(state.inRound) return; state.bets[idx]=+(state.bets[idx]+selectedChip).toFixed(2); state.lastBets[idx]=state.bets[idx]; renderSeatStack(idx); renderTop(); });
  seat.querySelector('.circle').addEventListener('contextmenu',e=>{ e.preventDefault(); if(state.inRound) return; state.bets[idx]=Math.max(0, +(state.bets[idx]-selectedChip).toFixed(2)); renderSeatStack(idx); renderTop(); });
  seat.querySelector('.circle').addEventListener('dblclick',()=>{ if(state.inRound) return; state.bets[idx]=0; renderSeatStack(idx); renderTop(); });
});

function anyBet(){ return state.bets.some(v=>v>0); }

async function startRound(){
  if(state.inRound) return; if(!anyBet()){ toast('Place ta mise d’abord.'); return; }
  const total=totalBet(); if(state.balance<total){ toast('Solde insuffisant. Clique BALANCE.'); return; }
  state.stats.hands++; state.win=0; state.balance-=total; state.hands=[[],[],[]]; state.dealer=[];
  for(let i=0;i<3;i++){ if(state.bets[i]>0){ state.hands[i].push(new Hand(state.bets[i])); } }
  state.dealer.push(drawCard(), drawCard()); state.activeSeat=state.bets.findIndex(v=>v>0); state.activeHand=0; state.inRound=true;
  const order=[]; for(let r=0;r<2;r++){ for(let s=0;s<3;s++){ if(state.bets[s]>0) order.push({seat:s}); } order.push({dealer:true, hide:r===1}); }
  for(const step of order){
    if(step.dealer){ const row=document.querySelector("#dealerRow"); const slot=document.createElement('div'); row.appendChild(slot); const card = step.hide ? state.dealer[1] : state.dealer[0]; await createAndAnimateCard(slot, card, !step.hide); }
    else{ const s=step.seat; const h=state.hands[s][0]; const newc=drawCard(); h.cards.push(newc); const area=document.querySelector(`.seat[data-idx="${s}"] .hand-area`); const slot=document.createElement('div'); area.appendChild(slot); await createAndAnimateCard(slot, newc, true); }
  }
  renderAllHands(); renderTop(); renderStats(); refreshControls();
}

function currentHand(){ return (state.hands[state.activeSeat]||[])[state.activeHand]; }
function moveToNextHand(){ for(let s=state.activeSeat;s<3;s++){ const hands=state.hands[s]||[]; for(let i=(s===state.activeSeat?state.activeHand+1:0); i<hands.length; i++){ if(!hands[i].done){ state.activeSeat=s; state.activeHand=i; return true; } } } return false; }

function updateActionsForActive(){
  if(!state.inRound){ setActionVisibility({hit:false,stand:false,double:false,split:false,surrender:false}); return; }
  const h=currentHand(); if(!h){ setActionVisibility({hit:false,stand:false,double:false,split:false,surrender:false}); return; }
  const v=handValue(h.cards);
  const canHit = v.total<21;
  const canStand = true;
  const canDouble = (h.cards.length===2) && state.balance>=h.bet;
  const v10=r=>['10','J','Q','K'].includes(r);
  const canSplit = (h.cards.length===2) && (h.cards[0].rank===h.cards[1].rank || (v10(h.cards[0].rank)&&v10(h.cards[1].rank))) && state.balance>=h.bet && (state.hands[state.activeSeat].length<4);
  const canSurrender = (h.cards.length===2);
  setActionVisibility({hit:canHit, stand:canStand, double:canDouble, split:canSplit, surrender:canSurrender});
}

function dealerPlayThenSettle(){
  flipHoleCard();
  setTimeout(()=>{
    let dv=handValue(state.dealer);
    const loop=()=>{
      if(dv.total<17 || (dv.total===17 && dv.soft)){
        const row=document.querySelector("#dealerRow"); const host=document.createElement('div'); row.appendChild(host);
        const c=drawCard(); state.dealer.push(c);
        createAndAnimateCard(host,c,true).then(()=>{ dv=handValue(state.dealer); setTimeout(loop, 220); });
      } else { settlePayouts(); }
    };
    loop();
  }, 220);
}

function seatRect(idx){ return document.querySelector(`.seat[data-idx="${idx}"] .circle`).getBoundingClientRect(); }
function dealerRect(){ return document.querySelector("#dealerBank").getBoundingClientRect(); }

function settlePayouts(){
  const dRect=dealerRect(); let win=0;
  for(let s=0;s<3;s++){
    for(const h of (state.hands[s]||[])){
      const pv=handValue(h.cards); const dv=handValue(state.dealer); let out=0;
      if(h.surrender){ out=-h.bet/2; animateChipsPath(seatRect(s), dRect, 8); state.stats.lost++; }
      else if(pv.total>21){ out=-h.bet; animateChipsPath(seatRect(s), dRect, 10); state.stats.lost++; }
      else{
        const dealerBJ=dv.isBJ; const bj=(pv.isBJ && h.cards.length===2 && !h.doubled && !h.surrender);
        if(dv.total>21){ out=h.bet; if(bj) out=h.bet*1.5; animateChipsPath(dRect, seatRect(s), 12); state.stats.won++; }
        else if(bj && !dealerBJ){ out=h.bet*1.5; animateChipsPath(dRect, seatRect(s), 14); state.stats.won++; }
        else if(!bj && dealerBJ){ out=-h.bet; animateChipsPath(seatRect(s), dRect, 10); state.stats.lost++; }
        else if(pv.total>dv.total){ out=h.bet; animateChipsPath(dRect, seatRect(s), 12); state.stats.won++; }
        else if(pv.total<dv.total){ out=-h.bet; animateChipsPath(seatRect(s), dRect, 10); state.stats.lost++; }
        else { out=0; }
      }
      state.balance += out + h.bet; win += out;
    }
  }
  state.win=win; renderTop(); renderStats(); toast(win>=0?`Tu gagnes ${money(win)}`:`Tu perds ${money(-win)}`,1800);
  state.inRound=false; refreshControls();
}

document.querySelector('#deal').addEventListener('click', startRound);
document.querySelector('#clearBets').addEventListener('click',()=>{ if(state.inRound) return; clearBets(); });
document.querySelector('#rebet').addEventListener('click',()=>{ if(state.inRound) return; rebet(); });
document.querySelector('#shuffle').addEventListener('click', buildShoe);

document.querySelector('#hit').addEventListener('click',async()=>{
  const h=currentHand(); if(!h) return; const v0=handValue(h.cards); if(v0.total>=21) return;
  const newc=drawCard(); h.cards.push(newc);
  const area=document.querySelector(`.seat[data-idx="${state.activeSeat}"] .hand-area`); const slot=document.createElement('div'); area.appendChild(slot);
  await createAndAnimateCard(slot, newc, true);
  const v=handValue(h.cards); if(v.total>=21){ h.done=true; if(!moveToNextHand()) dealerPlayThenSettle(); }
  renderAllHands(); updateActionsForActive();
});
document.querySelector('#stand').addEventListener('click',()=>{ const h=currentHand(); if(!h) return; h.done=true; if(!moveToNextHand()) dealerPlayThenSettle(); else updateActionsForActive(); renderAllHands(); });
document.querySelector('#double').addEventListener('click',async()=>{
  const h=currentHand(); if(!h||h.cards.length!==2) return; if(state.balance<h.bet){ toast('Solde insuffisant.'); return; }
  state.balance-=h.bet; h.bet*=2; h.doubled=true;
  const newc=drawCard(); h.cards.push(newc);
  const area=document.querySelector(`.seat[data-idx="${state.activeSeat}"] .hand-area`); const slot=document.createElement('div'); area.appendChild(slot);
  await createAndAnimateCard(slot, newc, true); h.done=true; renderTop();
  if(!moveToNextHand()) dealerPlayThenSettle(); else updateActionsForActive(); renderAllHands();
});
document.querySelector('#split').addEventListener('click',()=>{
  const h=currentHand(); if(!h||h.cards.length!==2) return; if(state.balance<h.bet){ toast('Solde insuffisant.'); return; }
  state.balance-=h.bet; const c2=h.cards.pop(); const h2=new Hand(h.bet); h2.cards=[c2]; h.cards=[h.cards[0]]; h.cards.push(drawCard()); h2.cards.push(drawCard());
  if(h.cards[0].rank==='A'){ h.isSplitAce=true; h.done=true; } if(h2.cards[0].rank==='A'){ h2.isSplitAce=true; h2.done=true; }
  state.hands[state.activeSeat].splice(state.activeHand+1,0,h2); renderTop(); renderAllHands(); updateActionsForActive();
});
document.querySelector('#surrender').addEventListener('click',()=>{ const h=currentHand(); if(!h||h.cards.length!==2) return; h.surrender=true; h.done=true; renderAllHands(); if(!moveToNextHand()) dealerPlayThenSettle(); else updateActionsForActive(); });

document.querySelector('#balance').addEventListener('click',()=>{ const v=parseFloat(prompt('Définir le solde :', state.balance)); if(!isFinite(v)||v<0) return; state.balance=+v.toFixed(2); renderTop(); });
document.addEventListener('keydown',e=>{ const k=e.key.toLowerCase();
  if(k==='d') document.querySelector('#deal').click(); else if(k==='h') document.querySelector('#hit').click(); else if(k==='s') document.querySelector('#stand').click(); else if(k==='2') document.querySelector('#double').click();
  else if(k==='p') document.querySelector('#split').click(); else if(k==='u') document.querySelector('#surrender').click(); else if(k==='r' && !state.inRound) document.querySelector('#rebet').click(); else if(k==='c' && !state.inRound) document.querySelector('#clearBets').click(); });

function init(){ buildShoe(); refreshBetsUI(); renderTop(); renderStats(); refreshControls(); }
init();
</script>
</body>
</html>"""
with open(html_path, "w", encoding="utf-8") as f:
    f.write(html_content)
html_path
